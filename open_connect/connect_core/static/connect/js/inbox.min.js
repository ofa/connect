"use strict";(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-(1/0),e=-(1/0);return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null!=a?null==b||c?a[0]:0>b?[]:h.call(a,0,b):void 0},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null!=a?null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0)):void 0},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b){var c=[],d=[];return y(a,function(a){(b(a)?c:d).push(a)}),[c,d]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null!=a){var c=a[b];return x.isFunction(c)?c.call(a):c}},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice;b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null!=a?this._byId[a]||this._byId[a.id]||this._byId[a.cid]:void 0},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a,b){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),
D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),function(){var a,b,c,d,e,f,g=[].slice;c=function(a){var b,d;return!_.isObject(a)||_.isFunction(a)?a:a instanceof Backbone.Collection||a instanceof Backbone.Model?a:_.isDate(a)?new Date(a.getTime()):_.isRegExp(a)?new RegExp(a.source,a.toString().replace(/.*\//,"")):(d=_.isArray(a||_.isArguments(a)),b=function(a,b,e){return d?a.push(c(b)):a[e]=c(b),a},_.reduce(a,b,d?[]:{}))},f=function(a){return null==a?!1:(a.prototype==={}.prototype||a.prototype===Object.prototype)&&_.isObject(a)&&!_.isArray(a)&&!_.isFunction(a)&&!_.isDate(a)&&!_.isRegExp(a)&&!_.isArguments(a)},b=function(a){return _.filter(_.keys(a),function(b){return f(a[b])})},a=function(a){return _.filter(_.keys(a),function(b){return _.isArray(a[b])})},e=function(c,d,f){var g,h,i,j,k,l,m,n,o,p;if(null==f&&(f=20),0>=f)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(c,d);for(l=_.intersection(b(c),b(d)),h=function(a){return d[a]=e(c[a],d[a],f-1)},m=0,o=l.length;o>m;m++)k=l[m],h(k);for(j=_.intersection(a(c),a(d)),g=function(a){return d[a]=_.union(c[a],d[a])},n=0,p=j.length;p>n;n++)i=j[n],g(i);return _.extend(c,d)},d=function(){var a,b,d,f;if(d=2<=arguments.length?g.call(arguments,0,f=arguments.length-1):(f=0,[]),b=arguments[f++],_.isNumber(b)||(d.push(b),b=20),d.length<=1)return d[0];if(0>=b)return _.extend.apply(this,d);for(a=d.shift();d.length>0;)a=e(a,c(d.shift()),b);return a},_.mixin({deepClone:c,isBasicObject:f,basicObjects:b,arrays:a,deepExtend:d})}.call(this),function(a){"function"==typeof define&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)}(function(a,b){function c(b){var d={},e=g.keyPathSeparator;for(var f in b){var h=b[f];if(h&&h.constructor===Object&&!a.isEmpty(h)){var i=c(h);for(var j in i){var k=i[j];d[f+e+j]=k}}else d[f]=h}return d}function d(b,c,d){for(var e=g.keyPathSeparator,f=c.split(e),h=b,i=0,j=f.length;j>i;i++){if(d&&!a.has(h,f[i]))return!1;if(h=h[f[i]],null==h&&j-1>i&&(h={}),"undefined"==typeof h)return d?!0:h}return d?!0:h}function e(b,c,d,e){e=e||{};for(var f=g.keyPathSeparator,h=c.split(f),i=b,j=0,k=h.length;k>j&&void 0!==i;j++){var l=h[j];j===k-1?e.unset?delete i[l]:i[l]=d:("undefined"!=typeof i[l]&&a.isObject(i[l])||(i[l]={}),i=i[l])}}function f(a,b){e(a,b,null,{unset:!0})}var g=b.Model.extend({constructor:function(b,c){var d,e=b||{};this.cid=a.uniqueId("c"),this.attributes={},c&&c.collection&&(this.collection=c.collection),c&&c.parse&&(e=this.parse(e,c)||{}),(d=a.result(this,"defaults"))&&(e=a.deepExtend({},d,e)),this.set(e,c),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(b){return a.deepClone(this.attributes)},get:function(a){return d(this.attributes,a)},set:function(b,h,i){var j,k,l,m,n,o,p,q;if(null==b)return this;if("object"==typeof b?(k=b,i=h||{}):(k={})[b]=h,i||(i={}),!this._validate(k,i))return!1;l=i.unset,n=i.silent,m=[],o=this._changing,this._changing=!0,o||(this._previousAttributes=a.deepClone(this.attributes),this.changed={}),q=this.attributes,p=this._previousAttributes,this.idAttribute in k&&(this.id=k[this.idAttribute]),k=c(k);for(j in k)h=k[j],a.isEqual(d(q,j),h)||m.push(j),a.isEqual(d(p,j),h)?f(this.changed,j):e(this.changed,j,h),l?f(q,j):e(q,j,h);if(!n){m.length&&(this._pending=!0);for(var r=g.keyPathSeparator,s=0,t=m.length;t>s;s++){var b=m[s];this.trigger("change:"+b,this,d(q,b),i);for(var u=b.split(r),v=u.length-1;v>0;v--){var w=a.first(u,v).join(r),x=w+r+"*";this.trigger("change:"+x,this,d(q,w),i)}}}if(o)return this;if(!n)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},clear:function(b){var d={},e=c(this.attributes);for(var f in e)d[f]=void 0;return this.set(d,a.extend({},b,{unset:!0}))},hasChanged:function(b){return null==b?!a.isEmpty(this.changed):void 0!==d(this.changed,b)},changedAttributes:function(b){if(!b)return this.hasChanged()?c(this.changed):!1;var d=this._changing?this._previousAttributes:this.attributes;b=c(b),d=c(d);var e,f=!1;for(var g in b)a.isEqual(d[g],e=b[g])||((f||(f={}))[g]=e);return f},previous:function(a){return null!=a&&this._previousAttributes?d(this._previousAttributes,a):null},previousAttributes:function(){return a.deepClone(this._previousAttributes)}});return g.keyPathSeparator=".",b.DeepModel=g,"undefined"!=typeof module&&(module.exports=g),b}),function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(c,d){return a.Marionette=a.Mn=b(a,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");module.exports=b(a,c,d)}else a.Marionette=a.Mn=b(a,a.Backbone,a._)}(this,function(a,b,c){!function(a,b){var c=a.ChildViewContainer;return a.ChildViewContainer=function(a,b){var c=function(a){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),b.each(a,this.add,this)};b.extend(c.prototype,{add:function(a,b){var c=a.cid;return this._views[c]=a,a.model&&(this._indexByModel[a.model.cid]=c),b&&(this._indexByCustom[b]=c),this._updateLength(),this},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){var b=this._indexByModel[a];return this.findByCid(b)},findByCustom:function(a){var b=this._indexByCustom[a];return this.findByCid(b)},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var c=a.cid;return a.model&&delete this._indexByModel[a.model.cid],b.any(this._indexByCustom,function(a,b){return a===c?(delete this._indexByCustom[b],!0):void 0},this),delete this._views[c],this._updateLength(),this},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,c){b.each(this._views,function(d){b.isFunction(d[a])&&d[a].apply(d,c||[])})},_updateLength:function(){this.length=b.size(this._views)}});var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return b.each(d,function(a){c.prototype[a]=function(){var c=b.values(this._views),d=[c].concat(b.toArray(arguments));return b[a].apply(b,d)}}),c}(a,b),a.ChildViewContainer.VERSION="0.1.6",a.ChildViewContainer.noConflict=function(){return a.ChildViewContainer=c,this},a.ChildViewContainer}(b,c),function(a,b){var c=a.Wreqr,d=a.Wreqr={};return a.Wreqr.VERSION="1.3.1",a.Wreqr.noConflict=function(){return a.Wreqr=c,this},d.Handlers=function(a,b){var c=function(a){this.options=a,this._wreqrHandlers={},b.isFunction(this.initialize)&&this.initialize(a)};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,c){var d=null;b.isObject(a)&&!b.isFunction(a)&&(d=a.context,a=a.callback),this.setHandler(c,a,d)},this)},setHandler:function(a,b,c){var d={callback:b,context:c};this._wreqrHandlers[a]=d,this.trigger("handler:add",a,b,c)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(b)return function(){var a=Array.prototype.slice.apply(arguments);return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}}),c}(a,b),d.CommandStorage=function(){var c=function(a){this.options=a,this._commands={},b.isFunction(this.initialize)&&this.initialize(a)};return b.extend(c.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];return b||(b={command:a,instances:[]},this._commands[a]=b),b},addCommand:function(a,b){var c=this.getCommands(a);c.instances.push(b)},clearCommands:function(a){var b=this.getCommands(a);b.instances=[]}}),c}(),d.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var c=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,c)},execute:function(a,b){a=arguments[0],b=Array.prototype.slice.call(arguments,1),this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,c,d){var e=this.storage.getCommands(a);b.each(e.instances,function(a){c.apply(d,a)}),this.storage.clearCommands(a)},_initializeStorage:function(a){var c,d=a.storageType||this.storageType;c=b.isFunction(d)?new d:d,this.storage=c}})}(d),d.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return this.hasHandler(a)?this.getHandler(a).apply(this,b):void 0}})}(d),d.EventAggregator=function(a,b){var c=function(){};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events),c}(a,b),d.Channel=function(c){var d=function(b){this.vent=new a.Wreqr.EventAggregator,this.reqres=new a.Wreqr.RequestResponse,this.commands=new a.Wreqr.Commands,this.channelName=b};return b.extend(d.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(a,b){return this._connect("vent",a,b),this},connectCommands:function(a,b){return this._connect("commands",a,b),this},connectRequests:function(a,b){return this._connect("reqres",a,b),this},_connect:function(a,c,d){if(c){d=d||this;var e="vent"===a?"on":"setHandler";b.each(c,function(c,f){this[a][e](f,b.bind(c,d))},this)}}}),d}(d),d.radio=function(a){var c=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};b.extend(c.prototype,{channel:function(a){if(!a)throw new Error("Channel must receive a name");return this._getChannel(a)},_getChannel:function(b){var c=this._channels[b];return c||(c=new a.Channel(b),this._channels[b]=c),c},_proxyMethods:function(){b.each(["vent","commands","reqres"],function(a){b.each(d[a],function(b){this[a][b]=e(this,a,b)},this)},this)}});var d={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},e=function(a,b,c){return function(d){var e=a._getChannel(d)[b],f=Array.prototype.slice.call(arguments,1);return e[c].apply(e,f)}};return new c}(d),a.Wreqr}(b,c);var d=a.Marionette,e=a.Mn,f=b.Marionette={};f.VERSION="2.4.1",f.noConflict=function(){return a.Marionette=d,a.Mn=e,this},b.Marionette=f,f.Deferred=b.$.Deferred,f.extend=b.Model.extend,f.isNodeAttached=function(a){return b.$.contains(document.documentElement,a)},f.mergeOptions=function(a,b){a&&c.extend(this,c.pick(a,b))},f.getOption=function(a,b){return a&&b?a.options&&void 0!==a.options[b]?a.options[b]:a[b]:void 0},f.proxyGetOption=function(a){return f.getOption(this,a)},f._getValue=function(a,b,d){return c.isFunction(a)&&(a=d?a.apply(b,d):a.call(b)),a},f.normalizeMethods=function(a){return c.reduce(a,function(a,b,d){return c.isFunction(b)||(b=this[b]),b&&(a[d]=b),a},{},this)},f.normalizeUIString=function(a,b){return a.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(a){return b[a.slice(4)]})},f.normalizeUIKeys=function(a,b){return c.reduce(a,function(a,c,d){var e=f.normalizeUIString(d,b);return a[e]=c,a},{})},f.normalizeUIValues=function(a,b,d){return c.each(a,function(e,g){c.isString(e)?a[g]=f.normalizeUIString(e,b):c.isObject(e)&&c.isArray(d)&&(c.extend(e,f.normalizeUIValues(c.pick(e,d),b)),c.each(d,function(a){var d=e[a];c.isString(d)&&(e[a]=f.normalizeUIString(d,b))}))}),a},f.actAsCollection=function(a,b){var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];c.each(d,function(d){a[d]=function(){var a=c.values(c.result(this,b)),e=[a].concat(c.toArray(arguments));return c[d].apply(c,e)}})};var g=f.deprecate=function(a,b){c.isObject(a)&&(a=a.prev+" is going to be removed in the future. Please use "+a.next+" instead."+(a.url?" See: "+a.url:"")),void 0!==b&&b||g._cache[a]||(g._warn("Deprecation warning: "+a),g._cache[a]=!0)};g._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},g._cache={},f._triggerMethod=function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi;return function(d,e,f){var g=arguments.length<3;g&&(f=e,e=f[0]);var h,i="on"+e.replace(b,a),j=d[i];return c.isFunction(j)&&(h=j.apply(d,g?c.rest(f):f)),c.isFunction(d.trigger)&&(g+f.length>1?d.trigger.apply(d,g?f:[e].concat(c.drop(f,0))):d.trigger(e)),h}}(),f.triggerMethod=function(a){return f._triggerMethod(this,arguments)},f.triggerMethodOn=function(a){var b=c.isFunction(a.triggerMethod)?a.triggerMethod:f.triggerMethod;return b.apply(a,c.rest(arguments))},f.MonitorDOMRefresh=function(a){function b(){a._isShown=!0,e()}function d(){a._isRendered=!0,e()}function e(){a._isShown&&a._isRendered&&f.isNodeAttached(a.el)&&c.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}a.on({show:b,render:d})},function(a){function b(b,d,e,f){var g=f.split(/\s+/);c.each(g,function(c){var f=b[c];if(!f)throw new a.Error('Method "'+c+'" was configured as an event handler, but does not exist.');b.listenTo(d,e,f)})}function d(a,b,c,d){a.listenTo(b,c,d)}function e(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];a.stopListening(b,d,e)})}function f(a,b,c,d){a.stopListening(b,c,d)}function g(b,d,e,f,g){if(d&&e){if(!c.isObject(e))throw new a.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});e=a._getValue(e,b),c.each(e,function(a,e){c.isFunction(a)?f(b,d,e,a):g(b,d,e,a)})}}a.bindEntityEvents=function(a,c,e){g(a,c,e,d,b)},a.unbindEntityEvents=function(a,b,c){g(a,b,c,f,e)},a.proxyBindEntityEvents=function(b,c){return a.bindEntityEvents(this,b,c)},a.proxyUnbindEntityEvents=function(b,c){return a.unbindEntityEvents(this,b,c)}}(f);var h=["description","fileName","lineNumber","name","message","number"];return f.Error=f.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+f.VERSION+"/",constructor:function(a,b){c.isObject(a)?(b=a,a=b.message):b||(b={});var d=Error.call(this,a);c.extend(this,c.pick(d,h),c.pick(b,h)),this.captureStackTrace(),b.url&&(this.url=this.urlRoot+b.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,f.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),f.Error.extend=f.extend,f.Callbacks=function(){this._deferred=f.Deferred(),this._callbacks=[]},c.extend(f.Callbacks.prototype,{add:function(a,b){var d=c.result(this._deferred,"promise");this._callbacks.push({cb:a,ctx:b}),d.then(function(c){b&&(c.context=b),a.call(c.context,c.options)})},run:function(a,b){this._deferred.resolve({options:a,context:b})},reset:function(){var a=this._callbacks;this._deferred=f.Deferred(),this._callbacks=[],c.each(a,function(a){this.add(a.cb,a.ctx)},this)}}),f.Controller=function(a){this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},f.Controller.extend=f.extend,c.extend(f.Controller.prototype,b.Events,{destroy:function(){return f._triggerMethod(this,"before:destroy",arguments),f._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:f.triggerMethod,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption}),f.Object=function(a){this.options=c.extend({},c.result(this,"options"),a),this.initialize.apply(this,arguments)},f.Object.extend=f.extend,c.extend(f.Object.prototype,b.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:f.triggerMethod,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents}),f.Region=f.Object.extend({constructor:function(a){if(this.options=a||{},this.el=this.getOption("el"),this.el=this.el instanceof b.$?this.el[0]:this.el,!this.el)throw new f.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),f.Object.call(this,a)},show:function(a,b){if(this._ensureElement()){this._ensureViewIsIntact(a);var c=b||{},d=a!==this.currentView,e=!!c.preventDestroy,g=!!c.forceShow,h=!!this.currentView,i=d&&!e,j=d||g;if(h&&this.triggerMethod("before:swapOut",this.currentView,this,b),this.currentView&&delete this.currentView._parent,i?this.empty():h&&j&&this.currentView.off("destroy",this.empty,this),j){a.once("destroy",this.empty,this),a.render(),a._parent=this,h&&this.triggerMethod("before:swap",a,this,b),this.triggerMethod("before:show",a,this,b),f.triggerMethodOn(a,"before:show",a,this,b),h&&this.triggerMethod("swapOut",this.currentView,this,b);var k=f.isNodeAttached(this.el),l=[],m=c.triggerBeforeAttach||this.triggerBeforeAttach,n=c.triggerAttach||this.triggerAttach;return k&&m&&(l=this._displayedViews(a),this._triggerAttach(l,"before:")),this.attachHtml(a),this.currentView=a,k&&n&&(l=this._displayedViews(a),this._triggerAttach(l)),h&&this.triggerMethod("swap",a,this,b),this.triggerMethod("show",a,this,b),f.triggerMethodOn(a,"show",a,this,b),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(a,b){var d=(b||"")+"attach";c.each(a,function(a){f.triggerMethodOn(a,d,a,this)},this)},_displayedViews:function(a){return c.union([a],c.result(a,"_getNestedViews")||[])},_ensureElement:function(){if(c.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new f.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(a){if(!a)throw new f.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(a.isDestroyed)throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+a.cid+'") has already been destroyed and cannot be used.'})},getEl:function(a){return b.$(a,f._getValue(this.options.parentEl,this))},attachHtml:function(a){this.$el.contents().detach(),this.el.appendChild(a.el)},empty:function(a){var b=this.currentView,c=f._getValue(a,"preventDestroy",this);return b?(b.off("destroy",this.empty,this),this.triggerMethod("before:empty",b),c||this._destroyView(),this.triggerMethod("empty",b),delete this.currentView,c&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var a=this.currentView;a.destroy&&!a.isDestroyed?a.destroy():a.remove&&(a.remove(),a.isDestroyed=!0)},attachView:function(a){return this.currentView=a,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(a,b){if(c.isString(a))return this._buildRegionFromSelector(a,b);if(a.selector||a.el||a.regionClass)return this._buildRegionFromObject(a,b);if(c.isFunction(a))return this._buildRegionFromRegionClass(a);throw new f.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(a,b){return new b({el:a})},_buildRegionFromObject:function(a,b){var d=a.regionClass||b,e=c.omit(a,"selector","regionClass");return a.selector&&!e.el&&(e.el=a.selector),new d(e)},_buildRegionFromRegionClass:function(a){return new a}}),f.RegionManager=f.Controller.extend({constructor:function(a){this._regions={},this.length=0,f.Controller.call(this,a),this.addRegions(this.getOption("regions"))},addRegions:function(a,b){return a=f._getValue(a,this,arguments),c.reduce(a,function(a,d,e){return c.isString(d)&&(d={selector:d}),d.selector&&(d=c.defaults({},d,b)),a[e]=this.addRegion(e,d),a},{},this)},addRegion:function(a,b){var c;return c=b instanceof f.Region?b:f.Region.buildRegion(b,f.Region),this.triggerMethod("before:add:region",a,c),c._parent=this,this._store(a,c),this.triggerMethod("add:region",a,c),c},get:function(a){return this._regions[a]},getRegions:function(){return c.clone(this._regions)},removeRegion:function(a){var b=this._regions[a];return this._remove(a,b),b},removeRegions:function(){var a=this.getRegions();return c.each(this._regions,function(a,b){this._remove(b,a)},this),a},emptyRegions:function(){var a=this.getRegions();return c.invoke(a,"empty"),a},destroy:function(){return this.removeRegions(),f.Controller.prototype.destroy.apply(this,arguments)},_store:function(a,b){this._regions[a]||this.length++,this._regions[a]=b},_remove:function(a,b){this.triggerMethod("before:remove:region",a,b),b.empty(),b.stopListening(),delete b._parent,delete this._regions[a],this.length--,this.triggerMethod("remove:region",a,b)}}),f.actAsCollection(f.RegionManager.prototype,"_regions"),f.TemplateCache=function(a){this.templateId=a},c.extend(f.TemplateCache,{templateCaches:{},get:function(a,b){var c=this.templateCaches[a];return c||(c=new f.TemplateCache(a),this.templateCaches[a]=c),c.load(b)},clear:function(){var a,b=c.toArray(arguments),d=b.length;if(d>0)for(a=0;d>a;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}}),c.extend(f.TemplateCache.prototype,{load:function(a){if(this.compiledTemplate)return this.compiledTemplate;var b=this.loadTemplate(this.templateId,a);return this.compiledTemplate=this.compileTemplate(b,a),this.compiledTemplate},loadTemplate:function(a,c){var d=b.$(a).html();if(!d||0===d.length)throw new f.Error({name:"NoTemplateError",message:'Could not find template: "'+a+'"'});return d},compileTemplate:function(a,b){return c.template(a,b)}}),f.Renderer={render:function(a,b){if(!a)throw new f.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var d=c.isFunction(a)?a:f.TemplateCache.get(a);return d(b)}},f.View=b.View.extend({isDestroyed:!1,constructor:function(a){c.bindAll(this,"render"),a=f._getValue(a,this),this.options=c.extend({},c.result(this,"options"),a),this._behaviors=f.Behaviors(this),b.View.call(this,this.options),f.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(a){return a.toJSON.apply(a,c.rest(arguments))},mixinTemplateHelpers:function(a){a=a||{};var b=this.getOption("templateHelpers");return b=f._getValue(b,this),c.extend(a,b)},normalizeUIKeys:function(a){var b=c.result(this,"_uiBindings");return f.normalizeUIKeys(a,b||c.result(this,"ui"))},normalizeUIValues:function(a,b){var d=c.result(this,"ui"),e=c.result(this,"_uiBindings");return f.normalizeUIValues(a,e||d,b)},configureTriggers:function(){if(this.triggers){var a=this.normalizeUIKeys(c.result(this,"triggers"));return c.reduce(a,function(a,b,c){return a[c]=this._buildViewTrigger(b),a},{},this)}},delegateEvents:function(a){return this._delegateDOMEvents(a),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),c.each(this._behaviors,function(a){a.bindEntityEvents(this.model,a.getOption("modelEvents")),a.bindEntityEvents(this.collection,a.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(a){var d=f._getValue(a||this.events,this);d=this.normalizeUIKeys(d),c.isUndefined(a)&&(this.events=d);var e={},g=c.result(this,"behaviorEvents")||{},h=this.configureTriggers(),i=c.result(this,"behaviorTriggers")||{};c.extend(e,g,d,h,i),b.View.prototype.delegateEvents.call(this,e)},undelegateEvents:function(){return b.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),c.each(this._behaviors,function(a){a.unbindEntityEvents(this.model,a.getOption("modelEvents")),a.unbindEntityEvents(this.collection,a.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var a=c.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(a)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(a)),this.unbindUIElements(),this.isRendered=!1,this.remove(),c.invoke(this._behaviors,"destroy",a),this},bindUIElements:function(){this._bindUIElements(),c.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=c.result(this,"_uiBindings");this.ui={},c.each(a,function(a,b){this.ui[b]=this.$(a)},this)}},unbindUIElements:function(){this._unbindUIElements(),c.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(a){var b=c.isObject(a),d=c.defaults({},b?a:{},{preventDefault:!0,stopPropagation:!0}),e=b?d.event:a;return function(a){a&&(a.preventDefault&&d.preventDefault&&a.preventDefault(),a.stopPropagation&&d.stopPropagation&&a.stopPropagation());var b={view:this,model:this.model,collection:this.collection};this.triggerMethod(e,b)}},setElement:function(){var a=b.View.prototype.setElement.apply(this,arguments);return c.invoke(this._behaviors,"proxyViewProperties",this),a},triggerMethod:function(){var a=f._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],c.rest(arguments)),a},_triggerEventOnBehaviors:function(a){for(var b=f._triggerMethod,c=this._behaviors,d=0,e=c&&c.length;e>d;d++)b(c[d],a)},_triggerEventOnParentLayout:function(a,b){var d=this._parentLayoutView();if(d){var e=f.getOption(d,"childViewEventPrefix"),g=e+":"+a;f._triggerMethod(d,[g,this].concat(b));var h=f.getOption(d,"childEvents"),i=d.normalizeMethods(h);i&&c.isFunction(i[a])&&i[a].apply(d,[this].concat(b))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var a=this._getImmediateChildren();return a.length?c.reduce(a,function(a,b){return b._getNestedViews?a.concat(b._getNestedViews()):a},a):a},_getAncestors:function(){for(var a=[],b=this._parent;b;)a.push(b),b=b._parent;return a},_parentLayoutView:function(){var a=this._getAncestors();return c.find(a,function(a){return a instanceof f.LayoutView})},normalizeMethods:f.normalizeMethods,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents}),f.ItemView=f.View.extend({constructor:function(){f.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var a=[this.model||this.collection];return arguments.length&&a.push.apply(a,arguments),this.model?this.serializeModel.apply(this,a):{items:this.serializeCollection.apply(this,a)}},serializeCollection:function(a){return a.toJSON.apply(a,c.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var a=this.getTemplate();if(a!==!1){if(!a)throw new f.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var b=this.mixinTemplateHelpers(this.serializeData()),c=f.Renderer.render(a,b,this);return this.attachElContent(c),this}},attachElContent:function(a){return this.$el.html(a),this}}),f.CollectionView=f.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(a){this.once("render",this._initialEvents),this._initChildViewStorage(),f.View.apply(this,arguments),this.on("show",this._onShowCalled),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&c.each(this._bufferedChildren,c.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(c.each(this._bufferedChildren,c.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(a,b){f.triggerMethodOn(b,a)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(a,b,d){var e;if(e=void 0!==d.at?d.at:c.indexOf(this._filteredSortedModels(),a),this._shouldAddChild(a,e)){this.destroyEmptyView();var f=this.getChildView(a);this.addChild(a,f,e)}},_onCollectionRemove:function(a){var b=this.children.findByModel(a);this.removeChildView(b),this.checkEmpty()},_onShowCalled:function(){this.children.each(c.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var a=this.children,b=this._filteredSortedModels(),d=c.find(b,function(b){return!a.findByModel(b)});if(d)this.render();else{var e=c.map(b,function(b){return a.findByModel(b).el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(e),this.triggerMethod("reorder")}},resortView:function(){f.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var a=this._filteredSortedModels(),b=c.find(a,function(a,b){var c=this.children.findByModel(a);return!c||c._index!==b},this);b&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(a){this.$el.append(a)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var a,b=this._filteredSortedModels();c.each(b,function(b,c){a=this.getChildView(b),this.addChild(b,a,c);
},this)},_filteredSortedModels:function(){var a,b=this.getViewComparator();return a=b?c.isString(b)||1===b.length?this.collection.sortBy(b,this):c.clone(this.collection.models).sort(c.bind(b,this)):this.collection.models,this.getOption("filter")&&(a=c.filter(a,function(a,b){return this._shouldAddChild(a,b)},this)),a},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var c=new b.Model;this.addEmptyView(c,a),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(a,b){var d=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");c.isFunction(d)&&(d=d.call(this,a,this._emptyViewIndex));var e=this.buildChildView(a,b,d);e._parent=this,this.proxyChildEvents(e),this._isShown&&f.triggerMethodOn(e,"before:show"),this.children.add(e),this.renderChildView(e,this._emptyViewIndex),this._isShown&&f.triggerMethodOn(e,"show")},getChildView:function(a){var b=this.getOption("childView");if(!b)throw new f.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return b},addChild:function(a,b,c){var d=this.getOption("childViewOptions");d=f._getValue(d,this,[a,c]);var e=this.buildChildView(a,b,d);return this._updateIndices(e,!0,c),this._addChildView(e,c),e._parent=this,e},_updateIndices:function(a,b,c){this.getOption("sort")&&(b&&(a._index=c),this.children.each(function(c){c._index>=a._index&&(c._index+=b?1:-1)}))},_addChildView:function(a,b){this.proxyChildEvents(a),this.triggerMethod("before:add:child",a),this._isShown&&!this.isBuffering&&f.triggerMethodOn(a,"before:show"),this.children.add(a),this.renderChildView(a,b),this._isShown&&!this.isBuffering&&f.triggerMethodOn(a,"show"),this.triggerMethod("add:child",a)},renderChildView:function(a,b){return a.render(),this.attachHtml(this,a,b),a},buildChildView:function(a,b,d){var e=c.extend({model:a},d);return new b(e)},removeChildView:function(a){return a&&(this.triggerMethod("before:remove:child",a),a.destroy?a.destroy():a.remove&&a.remove(),delete a._parent,this.stopListening(a),this.children.remove(a),this.triggerMethod("remove:child",a),this._updateIndices(a,!1)),a},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(a){a.$el.append(this._createBuffer(a))},_createBuffer:function(a){var b=document.createDocumentFragment();return c.each(a._bufferedChildren,function(a){b.appendChild(a.el)}),b},attachHtml:function(a,b,c){a.isBuffering?a._bufferedChildren.splice(c,0,b):a._insertBefore(b,c)||a._insertAfter(b)},_insertBefore:function(a,b){var c,d=this.getOption("sort")&&b<this.children.length-1;return d&&(c=this.children.find(function(a){return a._index===b+1})),c?(c.$el.before(a.el),!0):!1},_insertAfter:function(a){this.$el.append(a.el)},_initChildViewStorage:function(){this.children=new b.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),f.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){var a=this.children.map(c.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),a},_shouldAddChild:function(a,b){var d=this.getOption("filter");return!c.isFunction(d)||d.call(this,a,b,this.collection)},proxyChildEvents:function(a){var b=this.getOption("childViewEventPrefix");this.listenTo(a,"all",function(){var d=c.toArray(arguments),e=d[0],f=this.normalizeMethods(c.result(this,"childEvents"));d[0]=b+":"+e,d.splice(1,0,a),"undefined"!=typeof f&&c.isFunction(f[e])&&f[e].apply(this,d.slice(1)),this.triggerMethod.apply(this,d)})},_getImmediateChildren:function(){return c.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),f.CompositeView=f.CollectionView.extend({constructor:function(){f.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(a){var b=this.getOption("childView")||this.constructor;return b},serializeData:function(){var a={};return this.model&&(a=c.partial(this.serializeModel,this.model).apply(this,arguments)),a},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&f.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var a={};a=this.serializeData(),a=this.mixinTemplateHelpers(a),this.triggerMethod("before:render:template");var b=this.getTemplate(),c=f.Renderer.render(b,a,this);this.attachElContent(c),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(a){return this.$el.html(a),this},attachBuffer:function(a){var b=this.getChildViewContainer(a);b.append(this._createBuffer(a))},_insertAfter:function(a){var b=this.getChildViewContainer(this,a);b.append(a.el)},_appendReorderedChildren:function(a){var b=this.getChildViewContainer(this);b.append(a)},getChildViewContainer:function(a,b){if("$childViewContainer"in a)return a.$childViewContainer;var c,d=f.getOption(a,"childViewContainer");if(d){var e=f._getValue(d,a);if(c="@"===e.charAt(0)&&a.ui?a.ui[e.substr(4)]:a.$(e),c.length<=0)throw new f.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+a.childViewContainer})}else c=a.$el;return a.$childViewContainer=c,c},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),f.LayoutView=f.ItemView.extend({regionClass:f.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(a){a=a||{},this._firstRender=!0,this._initializeRegions(a),f.ItemView.call(this,a)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),f.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),f.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(a,b){return this.getRegion(a).show(b)},getChildView:function(a){return this.getRegion(a).currentView},addRegion:function(a,b){var c={};return c[a]=b,this._buildRegions(c)[a]},addRegions:function(a){return this.regions=c.extend({},this.regions,a),this._buildRegions(a)},removeRegion:function(a){return delete this.regions[a],this.regionManager.removeRegion(a)},getRegion:function(a){return this.regionManager.get(a)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(a){var b={regionClass:this.getOption("regionClass"),parentEl:c.partial(c.result,this,"el")};return this.regionManager.addRegions(a,b)},_initializeRegions:function(a){var b;this._initRegionManager(),b=f._getValue(this.regions,this,[a])||{};var d=this.getOption.call(a,"regions");d=f._getValue(d,this,[a]),c.extend(b,d),b=this.normalizeUIValues(b,["selector","el"]),this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new f.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(a){this.triggerMethod("before:add:region",a)}),this.listenTo(this.regionManager,"add:region",function(a,b){this[a]=b,this.triggerMethod("add:region",a,b)}),this.listenTo(this.regionManager,"before:remove:region",function(a){this.triggerMethod("before:remove:region",a)}),this.listenTo(this.regionManager,"remove:region",function(a,b){delete this[a],this.triggerMethod("remove:region",a,b)})},_getImmediateChildren:function(){return c.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),f.Behavior=f.Object.extend({constructor:function(a,b){this.view=b,this.defaults=c.result(this,"defaults")||{},this.options=c.extend({},this.defaults,a),this.ui=c.extend({},c.result(b,"ui"),c.result(this,"ui")),f.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(a){this.$el=a.$el,this.el=a.el}}),f.Behaviors=function(a,b){function c(a,d){return b.isObject(a.behaviors)?(d=c.parseBehaviors(a,d||b.result(a,"behaviors")),c.wrap(a,d,b.keys(g)),d):{}}function d(a,b){this._view=a,this._behaviors=b,this._triggers={}}function e(a){return a._uiBindings||a.ui}var f=/^(\S+)\s*(.*)$/,g={behaviorTriggers:function(a,b){var c=new d(this,b);return c.buildBehaviorTriggers()},behaviorEvents:function(c,d){var g={};return b.each(d,function(c,d){var h={},i=b.clone(b.result(c,"events"))||{};i=a.normalizeUIKeys(i,e(c));var j=0;b.each(i,function(a,e){var g=e.match(f),i=g[1]+"."+[this.cid,d,j++," "].join(""),k=g[2],l=i+k,m=b.isFunction(a)?a:c[a];h[l]=b.bind(m,c)},this),g=b.extend(g,h)},this),g}};return b.extend(c,{behaviorsLookup:function(){throw new a.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(b,d){return b.behaviorClass?b.behaviorClass:a._getValue(c.behaviorsLookup,this,[b,d])[d]},parseBehaviors:function(a,d){return b.chain(d).map(function(d,e){var f=c.getBehaviorClass(d,e),g=new f(d,a),h=c.parseBehaviors(a,b.result(g,"behaviors"));return[g].concat(h)}).flatten().value()},wrap:function(a,c,d){b.each(d,function(d){a[d]=b.partial(g[d],a[d],c)})}}),b.extend(d.prototype,{buildBehaviorTriggers:function(){return b.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(c,d){var f=b.clone(b.result(c,"triggers"))||{};f=a.normalizeUIKeys(f,e(c)),b.each(f,b.bind(this._setHandlerForBehavior,this,c,d))},_setHandlerForBehavior:function(a,b,c,d){var e=d.replace(/^\S+/,function(a){return a+".behaviortriggers"+b});this._triggers[e]=this._view._buildViewTrigger(c)}}),c}(f,c),f.AppRouter=b.Router.extend({constructor:function(a){this.options=a||{},b.Router.apply(this,arguments);var c=this.getOption("appRoutes"),d=this._getController();this.processAppRoutes(d,c),this.on("route",this._processOnRoute,this)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},_processOnRoute:function(a,b){if(c.isFunction(this.onRoute)){var d=c.invert(this.getOption("appRoutes"))[a];this.onRoute(a,d,b)}},processAppRoutes:function(a,b){if(b){var d=c.keys(b).reverse();c.each(d,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(a,b,d){var e=a[d];if(!e)throw new f.Error('Method "'+d+'" was not found on the controller');this.route(b,d,c.bind(e,a))},mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,triggerMethod:f.triggerMethod,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents}),f.Application=f.Object.extend({constructor:function(a){this._initializeRegions(a),this._initCallbacks=new f.Callbacks,this.submodules={},c.extend(this,a),this._initChannel(),f.Object.call(this,a)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("before:start",a),this._initCallbacks.run(a,this),this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(a){return this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},getRegions:function(){return this._regionManager.getRegions()},module:function(a,b){var d=f.Module.getClass(b),e=c.toArray(arguments);return e.unshift(this),d.create.apply(d,e)},getRegionManager:function(){return new f.RegionManager},_initializeRegions:function(a){var b=c.isFunction(this.regions)?this.regions(a):this.regions||{};this._initRegionManager();var d=f.getOption(a,"regions");return c.isFunction(d)&&(d=d.call(this,a)),c.extend(b,d),this.addRegions(b),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){f._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(a,b){this[a]=b,f._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){f._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(a){delete this[a],f._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=c.result(this,"channelName")||"global",this.channel=c.result(this,"channel")||b.Wreqr.radio.channel(this.channelName),this.vent=c.result(this,"vent")||this.channel.vent,this.commands=c.result(this,"commands")||this.channel.commands,this.reqres=c.result(this,"reqres")||this.channel.reqres}}),f.Module=function(a,b,d){this.moduleName=a,this.options=c.extend({},this.options,d),this.initialize=d.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=b,c.isFunction(this.initialize)&&this.initialize(a,b,this.options)},f.Module.extend=f.extend,c.extend(f.Module.prototype,b.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(c.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),c.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,d){if(a){var e=c.flatten([this,this.app,b,f,b.$,c,d]);a.apply(this,e)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new f.Callbacks,this._finalizerCallbacks=new f.Callbacks},triggerMethod:f.triggerMethod}),c.extend(f.Module,{create:function(a,b,d){var e=a,f=c.drop(arguments,3);b=b.split(".");var g=b.length,h=[];return h[g-1]=d,c.each(b,function(b,c){var g=e;e=this._getModule(g,b,a,d),this._addModuleDefinition(g,e,h[c],f)},this),e},_getModule:function(a,b,d,e,f){var g=c.extend({},e),h=this.getClass(e),i=a[b];return i||(i=new h(b,d,g),a[b]=i,a.submodules[b]=i),i},getClass:function(a){var b=f.Module;return a?a.prototype instanceof b?a:a.moduleClass||b:b},_addModuleDefinition:function(a,b,c,d){var e=this._getDefine(c),f=this._getStartWithParent(c,b);e&&b.addDefinition(e,d),this._addStartWithParent(a,b,f)},_getStartWithParent:function(a,b){var d;return c.isFunction(a)&&a.prototype instanceof f.Module?(d=b.constructor.prototype.startWithParent,c.isUndefined(d)?!0:d):c.isObject(a)?(d=a.startWithParent,c.isUndefined(d)?!0:d):!0},_getDefine:function(a){return!c.isFunction(a)||a.prototype instanceof f.Module?c.isObject(a)?a.define:null:a},_addStartWithParent:function(a,b,c){b.startWithParent=b.startWithParent&&c,b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}}),f});var Hogan={};!function(a){function b(a,b,c){var d;return b&&"object"==typeof b&&(void 0!==b[a]?d=b[a]:c&&b.get&&"function"==typeof b.get&&(d=b.get(a))),d}function c(a,b,c,d,e,f){function g(){}function h(){}g.prototype=a,h.prototype=a.subs;var i,j=new g;j.subs=new h,j.subsText={},j.buf="",d=d||{},j.stackSubs=d,j.subsText=f;for(i in b)d[i]||(d[i]=b[i]);for(i in d)j.subs[i]=d[i];e=e||{},j.stackPartials=e;for(i in c)e[i]||(e[i]=c[i]);for(i in e)j.partials[i]=e[i];return j}function d(a){return String(null===a||void 0===a?"":a)}function e(a){return a=d(a),k.test(a)?a.replace(f,"&amp;").replace(g,"&lt;").replace(h,"&gt;").replace(i,"&#39;").replace(j,"&quot;"):a}a.Template=function(a,b,c,d){a=a||{},this.r=a.code||this.r,this.c=c,this.options=d||{},this.text=b||"",this.partials=a.partials||{},this.subs=a.subs||{},this.buf=""},a.Template.prototype={r:function(a,b,c){return""},v:e,t:d,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var d=this.partials[a],e=b[d.name];if(d.instance&&d.base==e)return d.instance;if("string"==typeof e){if(!this.c)throw new Error("No compiler available.");e=this.c.compile(e,this.options)}if(!e)return null;if(this.partials[a].base=e,d.subs){b.stackText||(b.stackText={});for(key in d.subs)b.stackText[key]||(b.stackText[key]=void 0!==this.activeSub&&b.stackText[this.activeSub]?b.stackText[this.activeSub]:this.text);e=c(e,d.subs,d.partials,this.stackSubs,this.stackPartials,b.stackText)}return this.partials[a].instance=e,e},rp:function(a,b,c,d){var e=this.ep(a,c);return e?e.ri(b,c,d):""},rs:function(a,b,c){var d=a[a.length-1];if(!l(d))return void c(a,b,this);for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return l(a)&&0===a.length?!1:("function"==typeof a&&(a=this.ms(a,b,c,d,e,f,g)),h=!!a,!d&&h&&b&&b.push("object"==typeof a?a:b[b.length-1]),h)},d:function(a,c,d,e){var f,g=a.split("."),h=this.f(g[0],c,d,e),i=this.options.modelGet,j=null;if("."===a&&l(c[c.length-2]))h=c[c.length-1];else for(var k=1;k<g.length;k++)f=b(g[k],h,i),void 0!==f?(j=h,h=f):h="";return e&&!h?!1:(e||"function"!=typeof h||(c.push(j),h=this.mv(h,c,d),c.pop()),h)},f:function(a,c,d,e){for(var f=!1,g=null,h=!1,i=this.options.modelGet,j=c.length-1;j>=0;j--)if(g=c[j],f=b(a,g,i),void 0!==f){h=!0;break}return h?(e||"function"!=typeof f||(f=this.mv(f,c,d)),f):e?!1:""},ls:function(a,b,c,e,f){var g=this.options.delimiters;return this.options.delimiters=f,this.b(this.ct(d(a.call(b,e)),b,c)),this.options.delimiters=g,!1},ct:function(a,b,c){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:function(a){this.buf+=a},fl:function(){var a=this.buf;return this.buf="",a},ms:function(a,b,c,d,e,f,g){var h,i=b[b.length-1],j=a.call(i);return"function"==typeof j?d?!0:(h=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(j,i,c,h.substring(e,f),g)):j},mv:function(a,b,c){var e=b[b.length-1],f=a.call(e);return"function"==typeof f?this.ct(d(f.call(e)),e,c):f},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}};var f=/&/g,g=/</g,h=/>/g,i=/\'/g,j=/\"/g,k=/[&<>\"\']/,l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan);var templates={};templates.alert=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<div class="alert alert-dismissable alert-success alert-new hidden"><button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>'),d.b(d.v(d.f("message",a,b,0))),d.b("</div>"),d.fl()},partials:{},subs:{}}),templates.empty=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<div class="inbox-zero"><h4>'),d.b(d.v(d.f("header",a,b,0))),d.b("</h4><h5>"),d.b(d.v(d.f("subhead",a,b,0))),d.b("</h5></div>"),d.fl()},partials:{},subs:{}}),templates.group=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<a class="'),d.b(d.v(d.f("category",a,b,0))),d.b(" filter"),d.s(d.f("active",a,b,1),a,b,0,40,49,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(" selected")}),a.pop()),d.b('" data-groupid="'),d.b(d.v(d.f("id",a,b,0))),d.b('" href="#">'),d.b(d.v(d.f("shortname",a,b,0))),d.b("</a>"),d.fl()},partials:{},subs:{}}),templates.message=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.s(d.f("scrunched",a,b,1),a,b,1,0,0,"")||(d.b('<div class="panel-heading">'),d.b("\n"+c),d.b("    "),d.s(d.f("scrunchToggle",a,b,1),a,b,0,65,162,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b('<div class="scrunch-toggle"> '),c.b(c.v(c.f("scrunchLength",a,b,0))),c.b(" other messages in this thread, click to view</div>")}),a.pop()),d.b("\n"+c),d.s(d.f("scrunchToggle",a,b,1),a,b,1,0,0,"")||(d.b('    <a class="accordion-toggle">'),d.b("\n"+c),d.b("        "),d.s(d.f("active",a,b,1),a,b,1,0,0,"")||(d.b('<span class="msg-sender'),d.s(d.d("sender.sender_is_staff",a,b,1),a,b,0,306,312,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(" staff")}),a.pop()),d.b('">'),d.b(d.v(d.d("sender.sender",a,b,0))),d.b("</span>"),d.b("\n"+c),d.b('        <span class="msg-snippet">'),d.b(d.v(d.f("snippet",a,b,0))),d.b("</span>"),d.b("\n"+c),d.b('        <span class="msg-date">'),d.b(d.v(d.f("date",a,b,0))),d.b("</span>"),d.b("\n"+c)),d.b("    </a> "),d.b("\n"+c)),d.b("</div>"),d.b("\n"+c),d.b('<div id="'),d.b(d.v(d.f("id",a,b,0))),d.b('" class="panel-body collapse'),d.s(d.f("active",a,b,1),a,b,0,588,591,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(" in")}),a.pop()),d.b('">'),d.b("\n"+c),d.b('    <div class="panel-inner">'),d.b("\n"+c),d.s(d.f("is_system_message",a,b,1),a,b,1,0,0,"")||(d.b('        <a class="flag" href="'),d.b(d.v(d.f("flag_url",a,b,0))),d.b('" data-group="'),d.b(d.v(d.f("group",a,b,0))),d.b('" title="Flag this message for inappropriate content"><i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('flag"><span class="sr-only">Flag</span></i></a>'),d.b("\n"+c)),d.b("\n"+c),d.b('        <div class="row-fluid msg-text">'),d.b("\n"+c),d.s(d.f("pending",a,b,1),a,b,0,966,1063,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('                <div class="msg-pending">This message is pending approval</div>'),d.b("\n"+c)}),a.pop()),d.b('                <h5 class="msg-sender">'),d.b("\n"+c),d.s(d.f("is_system_message",a,b,1),a,b,1,0,0,"")||(d.b('                    <a href="'),d.b(d.v(d.d("sender.sender_url",a,b,0))),d.b('">'),d.b(d.v(d.d("sender.sender",a,b,0))),d.b("</a>"),d.b("\n"+c)),d.s(d.f("is_system_message",a,b,1),a,b,0,1320,1375,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b("                    Connect Admin"),d.b("\n"+c)}),a.pop()),d.b("                </h5>"),d.b("\n"+c),d.b("                "),d.s(d.d("sender.sender_is_staff",a,b,1),a,b,0,1463,1491,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b('<h6 class="staff">Staff</h6>')}),a.pop()),d.b("\n"),d.b("\n"),d.b("\n"+c),d.b('                <p class="msg-date">'),d.b(d.v(d.f("date",a,b,0))),d.b("</p>"),d.b("\n"+c),d.b("                "),d.b("\n"+c),d.b('                <div class="msg-content">'),d.b(d.t(d.f("text",a,b,0))),d.b("</div>"),d.b("\n"),d.b("\n"+c),d.b("        </div>"),d.b("\n"+c),d.b("    </div>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c)),d.fl()},partials:{},subs:{}}),templates.moderation=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<nav class="thread-nav row">'),d.b("\n"+c),d.b('	<a class="back-to-moderation btn btn-primary" href="/moderation/"><i class="icon-single-let-arrow"></i>Back to Moderation</a>'),d.b("\n"+c),d.b("</nav>"),d.b("\n"),d.b("\n"+c),d.b('<section class="thread-info row">'),d.b("\n"+c),d.b('	<div class="thread-title-mod">'),d.b("\n"+c),d.s(d.f("group",a,b,1),a,b,0,242,329,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('			<h5 class="thread-group '),d.b(d.v(d.f("category",a,b,0))),d.b('"><a href="'),d.b(d.v(d.f("group_url",a,b,0))),d.b('">'),d.b(d.v(d.f("group",a,b,0))),d.b("</a></h5>"),d.b("\n"+c)}),a.pop()),d.s(d.f("group",a,b,1),a,b,1,0,0,"")||(d.b('		    <h4 class="thread-group">'),d.b(d.v(d.f("recipients",a,b,0))),d.b("</h4>"),d.b("\n"+c)),d.b("		<h3>Message from Thread: "),d.b(d.v(d.f("subject",a,b,0))),d.b("</h3>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b('	<h4 class="mod-info">'),d.b("\n"+c),d.b("        "),d.s(d.d("mod.pending",a,b,1),a,b,0,516,580,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b('<i class="icon-checkmark"></i> This message is pending approval.')}),a.pop()),d.b("\n"+c),d.b("        "),d.s(d.d("mod.pending",a,b,1),a,b,1,0,0,"")||d.b('<i class="icon-flag"></i>This message was flagged as inappropriate.'),d.b("\n"+c),d.b("	</h4>"),d.b("\n"+c),d.b("</section>"),d.b("\n"+c),d.b('<section class="row">'),d.b("\n"+c),d.b('	<div class="msg-to-mod panel panel-default">'),d.b("\n"+c),d.b('		<div id="mod-'),d.b(d.v(d.d("mod.id",a,b,0))),d.b('" class="panel-body">'),d.b("\n"+c),d.b('		    <div class="panel-inner">'),d.b("\n"+c),d.b("			        <div class='row-fluid msg-text'>"),d.b("\n"+c),d.b('			            <h5 class="msg-sender">'),d.b("\n"+c),d.b('			                <a href="'),d.b(d.v(d.d("mod.sender.sender_url",a,b,0))),d.b('">'),d.b(d.v(d.d("mod.sender.sender",a,b,0))),d.b("</a>"),d.b("\n"+c),d.b("			            </h5>"),d.b("\n"+c),d.b("			            "),d.s(d.d("mod.sender.sender_is_staff",a,b,1),a,b,0,1135,1163,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b('<h6 class="staff">Staff</h6>')}),a.pop()),d.b("\n"+c),d.b('			            <p class="msg-date">'),d.b(d.v(d.d("mod.date",a,b,0))),d.b("</p>"),d.b("\n"+c),d.b("			            "),d.b("\n"+c),d.b("			            "),d.b(d.t(d.d("mod.text",a,b,0))),d.b("\n"+c),d.b("			        </div>"),d.b("\n"+c),d.b("			    </div>"),d.b("\n"+c),d.b("			</div>"),d.b("\n"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("</section>"),d.b("\n"+c),d.b('<section class="row">'),d.b("\n"+c),d.b("	<h3>Here is the message in the thread context:</h3>"),d.b("\n"+c),d.b('	<div class="thread-controls">'),d.b("\n"+c),d.b('			<a class="expand-all" href="#" title="Expand All Messages"><i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('collapse-down"></i></a>'),d.b("\n"+c),d.b('			<a class="collapse-all" href="#" title="Collapse All Messages"><i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('collapse-up"></i></a>'),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b('	<div id="msg-list" class="msg-list">'),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("</section>"),d.fl()},partials:{},subs:{}}),templates.threadArea=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b("<a"),d.s(d.f("active",a,b,1),a,b,0,13,33,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(' class="area-active"')}),a.pop()),d.b(' href="#">'),d.b(d.v(d.f("name",a,b,0))),d.b("</a>"),d.fl()},partials:{},subs:{}}),templates.threadMessages=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<nav class="thread-nav row">'),d.b("\n"+c),d.b('	<div class="back-to-inbox btn btn-primary">Back to Inbox</div>'),d.b("\n"+c),d.b('	<div class="compose btn btn-primary btn-glass hidden-xs">Compose</div>'),d.b("\n"+c),d.b("</nav>"),d.b("\n"),d.b("\n"+c),d.b('<section class="thread-info row">'),d.b("\n"+c),d.b('	<div class="thread-title">'),d.b("\n"+c),d.s(d.f("is_system_thread",a,b,1),a,b,1,0,0,"")||(d.s(d.f("group",a,b,1),a,b,0,271,358,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('			<h5 class="thread-group '),d.b(d.v(d.f("category",a,b,0))),d.b('"><a href="'),d.b(d.v(d.f("group_url",a,b,0))),d.b('">'),d.b(d.v(d.f("group",a,b,0))),d.b("</a></h5>"),d.b("\n"+c)}),a.pop()),d.s(d.f("group",a,b,1),a,b,1,0,0,"")||(d.b('		    <h4 class="thread-group">'),d.b(d.v(d.f("recipients",a,b,0))),d.b("</h4>"),d.b("\n"+c))),d.b("	"),d.b("\n"+c),d.b("		<h1>"),d.b(d.v(d.f("subject",a,b,0))),d.b("</h1>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b('	<div class="thread-controls">'),d.b("\n"+c),d.b('		<a class="expand-all" href="#" title="Expand All Messages"><i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('collapse-down"></i></a>'),d.b("\n"+c),d.b('		<a class="collapse-all" href="#" title="Collapse All Messages"><i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('collapse-up"></i></a>'),d.b("\n"+c),d.s(d.f("archived",a,b,1),a,b,1,0,0,"")||(d.b('			<a href="#" class="btn btn-info archive">Archive</a>'),d.b("\n"+c)),d.s(d.f("is_system_thread",a,b,1),a,b,1,0,0,"")||(d.b('			<a class="btn reply btn-primary" href="'),d.b(d.v(d.f("reply_url",a,b,0))),d.b('" title="reply">'),d.s(d.f("group",a,b,1),a,b,0,951,965,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b("Reply to Group")}),a.pop()),d.s(d.f("group",a,b,1),a,b,1,0,0,"")||d.b("Reply"),d.b("</a>"),d.b("\n"+c)),d.b("	</div>	"),d.b("\n"+c),d.b("</section>"),d.b("\n"),d.b("\n"+c),d.b('<div id="msg-list" class="msg-list row">'),d.b("\n"+c),d.b("</div>"),d.b("\n"),d.fl()},partials:{},subs:{}}),templates.threadPreview=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<div class="styled-checkbox">'),d.b("\n"+c),d.b("    <input "),d.s(d.f("active",a,b,1),a,b,0,52,59,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b("checked")}),a.pop()),d.b(' type="checkbox" name="check-'),d.b(d.v(d.f("id",a,b,0))),d.b('" id="check-'),d.b(d.v(d.f("id",a,b,0))),d.b('">'),d.b("\n"+c),d.b('    <label for="check-'),d.b(d.v(d.f("id",a,b,0))),d.b('">Select thread</label>'),d.b("\n"+c),d.b("</div>"),d.b("\n"+c),d.s(d.f("is_system_thread",a,b,1),a,b,1,0,0,"")||(d.b('<div class="row">'),d.b("\n"+c),d.b('	<div class="col-sm-4 col-xs-8">'),d.b("\n"+c),d.b("	"),d.b("\n"+c),d.b("	"),d.s(d.f("group",a,b,1),a,b,1,0,0,"")||(d.b('<i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('user"></i>')),d.b("\n"+c),d.b('		<div class="msg-subject">'),d.b(d.v(d.f("subject",a,b,0))),d.b("</div>"),d.b("\n"+c),d.b("		"),d.b("\n"+c),d.s(d.f("group",a,b,1),a,b,0,385,442,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('		        <h4 class="'),d.b(d.v(d.f("category",a,b,0))),d.b('">'),d.b(d.v(d.f("group",a,b,0))),d.b("</h4>"),d.b("\n"+c)}),a.pop()),d.s(d.f("group",a,b,1),a,b,1,0,0,"")||(d.b("		        <h4>"),d.b(d.v(d.f("recipients",a,b,0))),d.b("</h4>"),d.b("\n"+c)),d.b("		</div>"),d.b("\n"+c),d.b("	"),d.b("\n"+c),d.b('	<div class="col-sm-6 hidden-xs">'),d.b("\n"+c),d.b('		<div class="msg-snippet">'),d.b(d.v(d.f("snippet",a,b,0))),d.b("</div>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("	"),d.b("\n"+c),d.b('	<div class="col-sm-2 col-xs-4">'),d.b("\n"+c),d.b('		<div class="msg-date">'),d.b("\n"+c),d.b("			"),d.b(d.v(d.f("dateFormatted",a,b,0))),d.b("\n"+c),d.b("		</div>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c)),d.s(d.f("is_system_thread",a,b,1),a,b,0,767,997,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('<div class="row">'),d.b("\n"+c),d.b('	<div class="col-xs-8">'),d.b("\n"+c),d.b('		<i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('wrench"></i>'),d.b("\n"+c),d.b('		<div class="msg-subject">'),d.b(d.v(d.f("subject",a,b,0))),d.b("</div>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b('	<div class="col-xs-4">'),d.b("\n"+c),d.b('		<div class="msg-date">'),d.b("\n"+c),d.b("			"),d.b(d.v(d.f("dateFormatted",a,b,0))),d.b("\n"+c),d.b("		</div>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c)}),a.pop()),d.fl()},partials:{},subs:{}}),templates.threadlist=new Hogan.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<div class="row row-actions">'),d.b("\n"+c),d.b('	<div class="col-sm-5">'),d.b("\n"+c),d.b('	    <div class="select-styled'),d.s(d.f("total_threads",a,b,1),a,b,1,0,0,"")||d.b(" no-threads"),d.b('">'),d.b("\n"+c),d.s(d.f("total_threads",a,b,1),a,b,0,158,705,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('	        <select id="threadActions" name="actions">'),d.b("\n"+c),d.b("	        	"),d.b("\n"+c),d.b('		            <option value="">Choose an action</option>'),
d.b("\n"+c),d.s(d.f("unselect",a,b,1),a,b,1,0,0,"")||(d.b('	           			<option value="selectAll">Select All</option>'),d.b("\n"+c)),d.s(d.f("unselect",a,b,1),a,b,0,405,485,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('	            		<option value="unselectAll">Unselect All</option>'),d.b("\n"+c)}),a.pop()),d.s(d.f("archive",a,b,1),a,b,1,0,0,"")||(d.b('						<option value="archiveSelected">Archive selected</option>'),d.b("\n"+c)),d.b('					<option value="markReadSelected">Mark Selected as Read</option>'),d.b("\n"+c),d.b("	        </select>"),d.b("\n"+c)}),a.pop()),d.s(d.f("total_threads",a,b,1),a,b,1,0,0,"")||(d.b('				<div class="no-threads-text">No threads available</div>'),d.b("\n"+c)),d.b("	    </div>"),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b('	<div class="col-sm-3 col-sm-offset-4 hidden-xs">'),d.b("\n"+c),d.b('	    <a href="" class="btn btn-block btn-primary compose pull-right fill">'),d.b("\n"+c),d.b('	        <i class="'),d.b(d.v(d.f("icon_prefix",a,b,0))),d.b('pencil"></i> Compose</a>'),d.b("\n"+c),d.b("	</div>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c),d.s(d.f("messages_to_mod",a,b,1),a,b,0,1067,1285,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('<div class="alert-item item mod-msgs" data-alert="messages_to_mod">'),d.b("\n"+c),d.b('    <span class="msg-count">'),d.b(d.v(d.f("messages_to_mod",a,b,0))),d.b("</span>"),d.b("\n"+c),d.b("    <h4>"),d.b("\n"+c),d.b('       <a href="'),d.b(d.v(d.f("msg_mod_url",a,b,0))),d.b('">You have messages to moderate.</a>'),d.b("\n"+c),d.b("    </h4>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c)}),a.pop()),d.s(d.f("groups_to_mod",a,b,1),a,b,0,1324,1553,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('<div class="alert-item item mod-groups" data-alert="groups_to_mod">'),d.b("\n"+c),d.b('    <span class="msg-count">'),d.b(d.v(d.f("groups_to_mod",a,b,0))),d.b("</span>"),d.b("\n"+c),d.b("    <h4>"),d.b("\n"+c),d.b('       <a href="'),d.b(d.v(d.f("group_mod_url",a,b,0))),d.b('">You have group subscriptions to moderate.</a>'),d.b("\n"+c),d.b("    </h4>"),d.b("\n"+c),d.b("</div>"),d.b("\n"+c)}),a.pop()),d.s(d.f("unselect",a,b,1),a,b,0,1585,1768,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('<div class="select-info">'),d.b(d.v(d.f("numSelected",a,b,0))),d.b(" threads have been selected."),d.s(d.f("allMode",a,b,1),a,b,1,0,0,"")||(d.b(' <a href="#" class="all-mode">Select all '),d.b(d.v(d.f("total_threads",a,b,0))),d.b(" threads in "),d.b(d.v(d.f("area",a,b,0))),d.b("?</a>")),d.b("</div>"),d.b("\n"+c)}),a.pop()),d.b('<div class="threadlist" id="threadlist">'),d.b("\n"+c),d.b("</div>"),d.b("\n"+c),d.s(d.f("total_threads",a,b,1),a,b,0,1848,2233,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('<section class="thread-foot">'),d.b("\n"+c),d.b('	<div class="pg">'),d.b("\n"+c),d.s(d.f("prev",a,b,1),a,b,0,1908,1975,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('		<a href="#" class="pg-prev" title="Previous page">&#8592;</a>'),d.b("\n"+c)}),a.pop()),d.b('		<div class="pg-text">'),d.b("\n"+c),d.b("			Viewing "),d.b(d.v(d.f("start",a,b,0))),d.b(" - "),d.b(d.v(d.f("end",a,b,0))),d.s(d.f("has_other_pages",a,b,1),a,b,0,2059,2110,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(' of <span class="pg-total">'),c.b(c.v(c.f("total_threads",a,b,0))),c.b("</span>")}),a.pop()),d.b("\n"+c),d.b("		</div>"),d.b("\n"+c),d.s(d.f("next",a,b,1),a,b,0,2151,2214,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('		<a href="#" class="pg-next" title="Next page">&#8594;</a>'),d.b("\n"+c)}),a.pop()),d.b("	</div>"),d.b("\n"+c)}),a.pop()),d.b('	<nav class="disclaimer-links">'),d.b("\n"+c),d.b("	    <ul>"),d.b("\n"+c),d.b('	        <li><a href="#" title="Frequently Asked Questions">FAQ</a></li>'),d.b("\n"+c),d.b('	        <li><a href="#" title="Terms of Service">Terms<span class="hidden-xs"> of Service</span></a></li>'),d.b("\n"+c),d.b('	        <li class="hidden-xs"><a href="#" title="Privacy Policy">Privacy</a></li>'),d.b("\n"+c),d.b('	        <li><a href="#" title="Contact Us">Contact</a></li>'),d.b("\n"+c),d.b("	    </ul>"),d.b("\n"+c),d.b("	</nav>"),d.b("\n"+c),d.b("</section>"),d.fl()},partials:{},subs:{}}),Object.keys||(Object.keys=function(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}),Marionette.Renderer={render:function(a,b){return $.extend(b,{icon_prefix:window.CONNECT.icon_prefix}),window.templates[a].render(b)}},Backbone.Collection.prototype.setAll=function(a){return this.each(function(b){b.set(a)}),this},window.Inbox=new Backbone.Marionette.Application,Inbox.addRegions({areas:"#areas",areasMobile:"#areas-mobile",groups:"#groups",groupsMobile:"#groups-mobile",threadlist:"#threads-container",threaddetail:"#thread-detail"}),Inbox.module("Base",function(a,b,c,d,e,f){a.Model=c.DeepModel.extend({defaults:{active:!1},toggle:function(){this.set("active",!this.isActive())},isActive:function(){return this.get("active")}}),a.ModelView=d.ItemView.extend({tagName:"li",events:{click:"changeActive"},modelEvents:{change:"render"},changeActive:function(a){a.preventDefault(),this.model.collection.changeActive(this.model)}}),a.Collection=c.Collection.extend({model:a.Model,getActive:function(){return this.multi?this.where({active:!0}):this.findWhere({active:!0})},deactivate:function(){return!this.getActive()||this.multi&&!this.getActive().length?this:(this.multi?f.each(this.getActive(),function(a){a.set({active:!1})}):this.getActive().set({active:!1}),this)},changeActive:function(a){return this.disallowNull===!0&&a.isActive()?void 0:(this.multi||a.isActive()||this.deactivate(),a.toggle(),this.trigger("changeActive"),this)}})}),Inbox.module("State",function(a,b,c,d,e,f){var g=b.Base;a.State=c.DeepModel.extend({page1:{id:1,query:"&page=1"},defaults:{threadArea:{name:"Inbox",query:"?status=active"},group:{id:"",query:""},page:{id:1,query:"&page=1"},route:"inbox/"},initialize:function(a){this.threadAreas=a.threadAreas,this.groups=a.groups,this.listenTo(this.threadAreas,"changeActive",this.updateThreadArea),this.listenTo(this.groups,"changeActive",this.updateGroups)},makeRoute:function(){var a=this.get("threadArea.name").toLowerCase()+"/",b=this.get("group.id")?"group/"+this.get("group.id")+"/":"";this.set({route:a+b})},updateThreadArea:function(){this.set({threadArea:{name:this.threadAreas.getActive().get("name"),query:this.threadAreas.getActive().get("query")},page:this.page1}).makeRoute()},updateGroups:function(){this.set({group:{id:this.groups.getActive()?this.groups.getActive().get("id"):"",query:this.groups.getActive()?this.groups.getActive().get("query"):""},page:this.page1}).makeRoute()},updatePage:function(a){var b=this.get("page.id");b=1>b+a?1:b+a,this.set({page:{id:b,query:"&page="+b}})}}),a.ThreadAreas=g.Collection.extend({model:g.Model,initialize:function(){this.disallowNull=!0}}),a.Groups=g.Collection.extend({model:g.Model}),a.ThreadAreasView=d.CollectionView.extend({tagName:"ul",childView:g.ModelView.extend({template:"threadArea"})}),a.GroupsView=d.CollectionView.extend({tagName:"ul",childView:g.ModelView.extend({template:"group"})})}),Inbox.module("Threads",function(a,b,c,d,e,f,g){var h=b.Base,i=c.DeepModel.extend({defaults:{groups_to_mod:"",messages_to_mod:"",total_threads:"",page_number:"",total_pages:"",has_other_pages:"",archive:!1,unselect:!1,numSelected:"",allMode:!1,msg_mod_url:g.services.mod_msg,group_mod_url:g.services.mod_groups,area:"Inbox"},initialize:function(a,b){this.collection=b.collection,this.listenTo(this,"change:groups_to_mod change:messages_to_mod change:has_other_pages change:page_number change:total_pages change:total_threads",this.update),this.listenTo(this.collection.state,"change",this.update),this.listenTo(this.collection,"changeActive",this.update)},update:function(a){a=a||{};var b,c,d,e=20,f=this.get("page_number"),g=this.get("total_threads"),h=f*e>g?g:f*e,i=0===g?0:f>1?(f-1)*e:1,j=this.collection.state.get("threadArea.name");return this.collection.getActive().length&&(b=this.collection.getActive().length===this.collection.length,d=a.allMode||this.collection.getActive().length===g,c=a.numSelected?a.numSelected:this.collection.getActive().length),this.set({end:h,start:i,prev:i>1,next:g>h,area:j,archive:"Archive"===j,unselect:b,numSelected:c,allMode:d})}});a.Modifiers=i,a.Thread=h.Model.extend({decorate:function(){this.get("userthread_status")&&this.set({subject:this.get("subject").length<40?this.get("subject"):this.get("subject").slice(0,40)+"...",dateFormatted:moment(this.get("latest_message_at")).format("MMM Do")}).setArchived()},setArchived:function(){this.set({archived:"archived"===this.get("userthread_status")})}}),a.Threads=h.Collection.extend({model:a.Thread,initialize:function(a,b){this.controller=b.controller,this.multi=!0,this.init=!0,this.urlString="",this.state=b.state,g.badge.ready.then(function(a){this.badge=a}.bind(this)),this.modifiers=new i({archive:"Archive"===this.state.get("threadArea.name")},{collection:this}),this.listenTo(this.state,"change",f.debounce(this.update,180).bind(this)),this.update()},parse:function(a){var b=f.extend(a.alerts,a.paginator);return this.modifiers.set(b),a.threads},badgeCheck:function(){this.badge.$el.off("updated"),"Inbox"===this.state.get("threadArea.name")&&this.badge.$el.on("updated",function(){this.fetch()}.bind(this))},setTitleText:function(){var a=this.state.get("group.query")?this.state.groups.get(this.state.get("group.id")).get("name"):"",b=this.state.get("threadArea.name"),c=a?a+" in "+b:b;this.trigger("changeTitle",c)},update:function(a){this.deactivate(),this.setTitleText(),this.badge&&this.badgeCheck(),this.init||this.controller.router.navigate(this.state.get("route")),this.urlString=this.state.get("threadArea.query")+this.state.get("group.query")+this.state.get("page.query"),this.fetch(),this.init=!1},url:function(){return g.services.threads+this.urlString}});var j=d.ItemView.extend({template:"empty",tagName:"div",initialize:function(a){this.model.set({header:a.header,subhead:a.subhead})}}),k=h.ModelView.extend({template:"threadPreview",tagName:"div",className:"thread-item",ui:{toggle:"label"},events:{click:"showDetail","click @ui.toggle":"changeActive"},onBeforeRender:function(){this.model.decorate();var a=this.model.get("read")?"":" not-read",b=this.model.get("is_system_thread")?"system":this.model.get("category")?this.model.get("category"):"personal";this.$el.attr("class","thread-item item "+b+a)},showDetail:function(a){if(a.preventDefault(),"LABEL"!=a.target.tagName&&"INPUT"!=a.target.tagName){this.model.set({read:!0}),this.model.get("unread_messages")&&this.model.collection.badge.markRead(this.model.get("unread_messages"));var b=this.model.get("id"),c=!this.model.get("read");return this.model.collection.trigger("showDetail",b,c),this}}});a.ThreadPreview=k,a.ThreadPreviewList=d.CompositeView.extend({ui:{actions:"#threadActions",compose:".compose",paginator_next:".pg-next",paginator_prev:".pg-prev",allMode:".all-mode",tourButton:".take-tour"},events:{"click @ui.paginator_next":"nextPage","click @ui.paginator_prev":"prevPage","click @ui.allMode":"changeMode","click @ui.tourButton":"takeTour"},template:"threadlist",childView:k,childViewContainer:"#threadlist",emptyView:j,emptyViewOptions:{header:"INBOX ZERO",subhead:"Nice job!"},initialize:function(){this.model=this.collection.modifiers,this.listenTo(this.model,"change",this.render),this.listenTo(this.collection.state,"change",this.emptyStates)},onBeforeRender:function(){this.scrollTop=e(this.childViewContainer).scrollTop()},onRender:function(){this.ui.actions.on("change",function(a){this[e(a.target).val()].call(this,this.model.get("allMode"))}.bind(this)),this.ui.compose.attr("href",g.services.compose);var a=new Compose(this.$el.find(".compose"));return a.$el.on("compose.sent",function(a,b,c){ga("send","event","Compose Action","Message sent",b+", "+c)}),a.$el.on("compose.shown",function(){ga("send","event","Compose Action","New message","New message")}),this.resize(),e(window).off("resize.childview").on("resize.childview",function(){f.debounce(this.resize(),200)}.bind(this)),this.model.changedAttributes().page_number?void(this.scrollTop=0):void e(this.childViewContainer).scrollTop(this.scrollTop)},takeTour:function(a){a.preventDefault(),e.post(g.services.tour,{csrfmiddlewaretoken:e("[name=csrfmiddlewaretoken]").val()},"json").done(function(a){this.ui.tourButton.off(),document.location=g.services.explore}.bind(this))},resize:function(){this.$el.find(this.childViewContainer).css({height:Math.ceil(.59*e(window).height())})},emptyStates:function(){var a,b=f.debounce(this.render,300).bind(this),c=this.collection.state.get("group.id");if(""!==c){var d=this.collection.state.groups;return this.emptyViewOptions={header:"No messages",subhead:'No messages are in this area for the group "'+d.get(c).get("name")+'". Choose a different group, or a different message area.'},void b()}switch(this.collection.state.get("threadArea.name")){case"Unread":a={header:"No unread messages",subhead:"Good work!"};break;case"Archive":a={header:"No archived messages",subhead:"Use the archive options in the inbox."};break;default:a={header:"INBOX ZERO",subhead:"Nice job!"}}this.emptyViewOptions=a,b()},nextPage:function(a){a.preventDefault(),this.scrollTop=0,this.collection.state.updatePage(1)},prevPage:function(a){a.preventDefault(),this.scrollTop=0,this.collection.state.updatePage(-1)},selectAll:function(){this.collection.setAll({active:!0}).trigger("changeActive"),this.resetActions()},unselectAll:function(){this.collection.setAll({active:!1}).trigger("changeActive"),this.resetActions()},activeIDs:function(){return f.pluck(this.collection.getActive(),"id").join()},markReadSelected:function(a){this.modSelected(a,{read:!0})},archiveSelected:function(a){this.modSelected(a,{status:"archived"}),this.collection.deactivate().trigger("changeActive")},modSelected:function(a,b){if(this.resetActions(),this.collection.getActive()){if(a)return this.modAll(b);var c=this.activeIDs();this.collection.trigger("post",g.services.threads+"?id="+c,b,function(){this.collection.fetch()},this)}},modAll:function(a){var b;a.read?(this.collection.badge.markRead(this.model.get("total_threads")),b=function(){this.collection.setAll({read:!0})}):(this.collection.deactivate(),this.collection.trigger("changeActive"),b=function(){this.collection.reset()}),this.collection.trigger("post",g.services.threads+this.collection.state.get("threadArea.query"),a,b,this)},resetActions:function(){this.ui.actions.val("")},changeMode:function(a){a.preventDefault(),this.model.update({allMode:!0,numSelected:this.model.get("total_threads")})}})},window.CONNECT),Inbox.module("Messages",function(a,b,c,d,e,f,g,h,i){var j=b.Base.Model.extend({initialize:function(){var a=this.get("sent_at");this.set({active:!this.get("read"),date:moment(a).calendar()})},setScrunch:function(){this.get("scrunchToggle")||this.get("active")||this.set({scrunched:!0})}});a.Message=j,a.Messages=b.Base.Collection.extend({model:j,initialize:function(a,c){this.id=c.id,this.url=c.url,this.multi=!0,this.fetch().done(function(){this.afterFetch()}.bind(this)),this.thread=new b.Threads.Thread},comparator:"sent_at",parse:function(a){return this.thread.set(a.thread),a.connectmessages},afterFetch:function(){this.cached=!0,this.last().set({active:!0}),this.read=this.where({read:!0}),this.read.length>5&&this.scrunch(),this.trigger("fetchComplete")},scrunch:function(){this.read[0].set({scrunchToggle:!0,scrunchLength:this.read.length-1}),f.each(this.read,function(a){a.setScrunch()})},unscrunch:function(){this.setAll({scrunchToggle:!1,scrunched:!1})}}),a.Mod=a.Messages.extend({initialize:function(a,c){this.id=c.id,this.url=c.url,this.multi=!0,this.fetch().done(function(){this.afterFetch(c.mod)}.bind(this)),this.thread=new b.Threads.Thread},afterFetch:function(a){this.thread.set({mod:this.get(a).attributes}),this.setAll({active:!1})}});var k=b.Base.ModelView.extend({template:"message",tagName:"div",ui:{toggle:".accordion-toggle",flag:".flag"},className:"panel panel-default",events:{"click @ui.toggle":"changeActive","click @ui.flag":"flagPrompt"},onRender:function(){this.linkBlanker(),this.model.get("scrunched")?this.$el.attr("class",""):this.$el.attr("class",this.className)},linkBlanker:function(){this.$el.find(".msg-text a").not("[href*='"+window.location.host+"']").not("[href^='/']").each(function(){e(this).attr("target","_blank")})},flagPrompt:function(a){a.preventDefault();var b=this.ui.flag.attr("href"),c=this.ui.flag.attr("data-group");h.confirm("Are you sure you want to flag this message for inappropriate content?",function(a){a&&this.model.collection.trigger("flag",this.model,b,c)}.bind(this))}});a.MessageView=k,a.MessagesView=d.CompositeView.extend({template:"threadMessages",childView:k,childViewContainer:"#msg-list",className:"container thread-messages",ui:{reply:".reply",archive:".archive",compose:".compose",back:".back-to-inbox",expand:".expand-all",collapse:".collapse-all",scrunchToggle:".scrunch-toggle"},events:{"click @ui.archive":"archive","click @ui.back":"back","click @ui.expand":"expandAll","click @ui.collapse":"collapseAll","click @ui.scrunchToggle":"unscrunch"},childEvents:{render:"oembed"},initialize:function(a){this.model=this.collection.thread,this.listenTo(this.model,"change",this.render),this.listenTo(this.collection,"flag",this.flag),this.collection.cached||this.listenTo(this.collection,"fetchComplete",function(){this.oembed()}.bind(this))},onBeforeRender:function(){this.model.setArchived()},onRender:function(){this.bindReply(),this.collection.cached&&this.oembed()},oembed:function(){var a=this;this.$el.find(".msg-content a").not(".done").each(function(){(""===e(this).html()||"true"===e(this).attr("data-embed"))&&(e(this).oembed(null,{includeHandle:!1,afterEmbed:function(){e(this).addClass("done")}}),a.refreshEmbeds())})},refreshEmbeds:function(){setTimeout(function(){i.widgets.load(),instgrm.Embeds.process(),e("a[data-flickr-embed]").remove()},500)},collapseAll:function(a){a.preventDefault(),this.collection.deactivate()},expandAll:function(a){a.preventDefault(),this.collection.setAll({active:!0,scrunched:!1,scrunchToggle:!1})},bindReply:function(){if(!g.mobile){var a=new Compose(this.ui.reply);a.$el.on("compose.shown",function(){ga("send","event","Compose Action","New message",a.messageType+", "+a.to)}),a.$el.on("compose.sent",function(a,b,c){ga("send","event","Compose Action","Message sent",b+", "+c)}),this.ui.compose.attr("href",g.services.compose);var b=new Compose(this.$el.find(".compose"));b.$el.on("compose.sent",function(a,b,c){ga("send","event","Compose Action","Message sent",b+", "+c)}),b.$el.on("compose.shown",function(){ga("send","event","Compose Action","New message","New message")})}},back:function(a){a&&a.preventDefault(),this.trigger("back")},archive:function(a){a.preventDefault();var b=this.model.get("id");this.trigger("post",g.services.threads+"?id="+b,{status:"archived"},function(){this.back(),this.threads.remove(b)})},unscrunch:function(){this.collection.unscrunch()},flag:function(a,b,c){this.trigger("post",b,"",function(){this.collection.remove(a),this.collection.length||this.trigger("back")},this),ga("send","event","Inbox Action","Flag",c)}}),a.ModView=a.MessagesView.extend({template:"moderation"})},window.CONNECT,bootbox,twttr),Inbox.module("Controller",function(a,b,c,d,e,f){var g=b.Threads,h=b.Messages,i=b.State;a.Router=d.AppRouter.extend({routes:{"":"redir","inbox(/)(group/:id/)":"inbox","unread(/)(group/:id/)":"unread","archive(/)(group/:id/)":"archive","id/:id(/)":"showDetail","mod/:thread/msg/:msg(/)":"moderate"},initialize:function(a){this.controller=a.controller},redir:function(){this.navigate("inbox/",{trigger:!0})},inbox:function(a){this.changeArea("Inbox",a)},unread:function(a){this.changeArea("Unread",a)},archive:function(a){this.changeArea("Archive",a)},changeArea:function(a,b){if(c.history.root+this.controller.threads.state.get("route")===window.location.pathname)return void this.controller.hideDetail();if(a){var d=this.controller.threadAreas.findWhere({name:a});this.controller.threadAreas.changeActive(d)}this.controller.threads.state.get("group.id");if(b||this.controller.groups.deactivate(),b){var e=this.controller.groups.findWhere({id:parseInt(b)});this.controller.groups.changeActive(e)}},showDetail:function(a){this.controller.showDetail(a)},moderate:function(a,b){this.controller.moderate(a,b)}}),a.Controller=d.Controller.extend({initialize:function(){this.csrf=e("[name=csrfmiddlewaretoken]").val(),this.threadAreas=new i.ThreadAreas([{name:"Inbox",query:"?status=active",active:!0},{name:"Unread",query:"?read=false",active:!1},{name:"Archive",query:"?status=archived",active:!1}]),this.groups=new i.Groups(CONNECT.user.groups),this.threads=new g.Threads(!1,{controller:this,state:new i.State({groups:this.groups,threadAreas:this.threadAreas})}),this.store=new c.Collection,this.modStore=new c.Collection},start:function(){new i.ThreadAreasView({collection:this.threadAreas}),new i.GroupsView({collection:this.groups});b.threadlist.show(new g.ThreadPreviewList({collection:this.threads})),this.listenTo(this.threads,"showDetail",this.showDetail),this.listenTo(this.threads,"post",this.post),this.listenTo(this.threads,"mod",this.moderate),this.listenTo(this.threads,"changeTitle",this.changeTitle),this.areasView=new i.ThreadAreasView({collection:this.threadAreas}),this.groupView=new i.GroupsView({collection:this.groups}),this.setViews(mobileChange()),e(window).on("mobileSwitch",function(a,b){this.setViews(b)}.bind(this))},changeTitle:function(a){document.title="Connect | "+a},setViews:function(a){var c,d,e,f;a?(c="areasMobile",f="groups",e="areas",d="groupsMobile"):(c="areas",f="groupsMobile",e="areasMobile",d="groups"),b[e].hasView()&&b[e].empty({preventDestroy:!0}),b[f].hasView()&&b[f].empty({preventDestroy:!0}),b[c].show(this.areasView),b[d].show(this.groupView)},moderate:function(a,d){e("body").addClass("detail"),this.router.navigate("mod/"+a+"/msg/"+d+"/");var f,g=this.modStore.get({id:a});g?f=g:(f=new c.DeepModel({id:a,messages:new h.Mod(!1,{id:a,url:"/messages/"+a+"/json/",mod:d})}),this.modStore.add(f)),this.msgView=new h.ModView({collection:f.get("messages")}),b.threaddetail.show(this.msgView),b.threaddetail.$el.removeClass("hidden")},showDetail:function(a,d){this.router.navigate("id/"+a+"/"),e("body").addClass("detail");var f,g=this.store.get({id:a});d||!g?(f=new c.DeepModel({id:a,messages:new h.Messages(!1,{id:a,url:"/messages/"+a+"/json/"})}),this.store.add(f)):f=g,this.msgView=new h.MessagesView({collection:f.get("messages"),cached:!!g}),this.listenTo(this.msgView,"changeTitle",this.changeTitle),this.listenTo(this.msgView,"post",this.post),this.listenTo(this.msgView,"back",this.back),b.threaddetail.show(this.msgView),b.threaddetail.$el.removeClass("hidden")},hideDetail:function(){e("body").removeClass("detail"),b.threaddetail.hasView()&&(this.stopListening(this.msgView),b.threaddetail.$el.addClass("hidden"),b.threaddetail.reset())},back:function(){this.hideDetail(),this.router.navigate(this.threads.state.get("route"))},post:function(a,b,c,d){var f=e.extend(b,{csrfmiddlewaretoken:this.csrf});e.post(a,f).done(function(){return c?d?c.call(d):void c.call(this):void 0}.bind(this))}}),b.on("start",function(){var b=new a.Controller;b.router=new a.Router({controller:b}),b.start(),c.history.start({pushState:!0,root:"/messages/"})})});